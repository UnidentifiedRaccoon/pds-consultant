# PDS Consultant Bot

Простой Telegram бот-консультант по ПДС с двумя основными функциями: рассчитать и узнать о ПДС.

## Разработка

### Быстрый старт

1. **Установите зависимости:**

   ```bash
   npm install
   ```

2. **Установите ngrok:**

   ```bash
   # macOS
   brew install ngrok

   # Или скачайте с https://ngrok.com/
   ```

3. **Настройте переменные окружения:**

   ```bash
   cp .env.example .env
   # Отредактируйте .env файл
   ```

4. **Запустите в режиме разработки:**
   ```bash
   npm run dev
   ```

### Режимы запуска

- **`npm run dev`** - Полная разработка с ngrok и автоперезагрузкой
- **`npm run dev:server`** - Только сервер с автоперезагрузкой (без ngrok)
- **`npm run start:ngrok`** - Продакшн режим с ngrok (без автоперезагрузки)
- **`npm start`** - Обычный запуск сервера

### Автоматическая регистрация webhook

При использовании `npm run dev`:

- ✅ **Webhook регистрируется автоматически** при создании ngrok туннеля
- ✅ **Код перезагружается автоматически** при изменении файлов в `src/`
- ✅ **ngrok URL остается постоянным** во время разработки
- ✅ **Сервер перезапускается** за ~1 секунду
- ✅ **Логи показывают** статус регистрации webhook

### Управление webhook

Дополнительные команды для управления webhook:

```bash
# Получить информацию о текущем webhook
npm run webhook:info

# Установить webhook вручную
npm run webhook:set https://your-domain.com/tg/your_secret

# Удалить webhook
npm run webhook:delete
```

### Процесс разработки

1. **Запустите:** `npm run dev`
2. **Webhook регистрируется автоматически** - никаких ручных действий не требуется!
3. **Редактируйте код** - сервер перезагружается автоматически
4. **Тестируйте бота** - webhook URL остается тем же!

## Продакшн

Для продакшн деплоя используется Docker и Yandex Cloud Serverless Container.

### Переменные окружения

- `TELEGRAM_BOT_TOKEN` - Токен бота от @BotFather
- `WEBHOOK_SECRET` - Секретный ключ для webhook
- `PUBLIC_BASE_URL` - Публичный URL (для продакшн)
- `DEV_PORT` - Порт для разработки (по умолчанию 8080)
