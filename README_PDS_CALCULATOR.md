# –ü–î–°-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä

–ù–æ–≤—ã–π FSM-based –∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –¥–ª—è –ü—Ä–æ–≥—Ä–∞–º–º—ã –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã—Ö —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π (–ü–î–°) —Å —Ç—Ä–µ–º—è —Å—Ü–µ–Ω–∞—Ä–∏—è–º–∏ —Ä–∞—Å—á—ë—Ç–∞.

## üéØ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –¢—Ä–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è —Ä–∞—Å—á—ë—Ç–∞:

1. **üí∞ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞** ‚Äî —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–π –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –≤–∑–Ω–æ—Å –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∂–µ–ª–∞–µ–º–æ–π –µ–∂–µ–º–µ—Å—è—á–Ω–æ–π –≤—ã–ø–ª–∞—Ç—ã
2. **üè¶ –ö–∞–ø–∏—Ç–∞–ª –∫ –Ω–∞—á–∞–ª—É –≤—ã–ø–ª–∞—Ç** ‚Äî —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å –∫–∞–ø–∏—Ç–∞–ª –∫ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–º—É –≤–æ–∑—Ä–∞—Å—Ç—É/–¥–∞—Ç–µ
3. **üí∏ –ë–µ–∑ —Ü–µ–ª–∏ ‚Äî —Ä–∞—Å—á—ë—Ç –æ—Ç –≤–∑–Ω–æ—Å–∞** ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –ø–æ–ª—É—á–∏—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥—É–ª—è—Ä–Ω—ã—Ö –≤–∑–Ω–æ—Å–∞—Ö

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:

- **FSM (Finite State Machine)** ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–µ –¥–∏–∞–ª–æ–≥–∏ —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- **ReplyKeyboardMarkup** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–µ –º–µ–Ω—é –∏ –≤—ã–±–æ—Ä –æ–ø—Ü–∏–π
- **InlineKeyboard** ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏ –≤—ã–±–æ—Ä –º–æ–¥–µ–ª–µ–π –≤—ã–ø–ª–∞—Ç
- **In-memory —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ß–∏—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å—á—ë—Ç–∞** ‚Äî –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
src/bot/
‚îú‚îÄ‚îÄ state/
‚îÇ   ‚îú‚îÄ‚îÄ types.js           # –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ machine.js         # FSM-–¥–∏—Å–ø–µ—Ç—á–µ—Ä –∏ –≤–∞–ª–∏–¥–∞—Ç–æ—Ä—ã
‚îÇ   ‚îî‚îÄ‚îÄ scenarios/         # –°—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞—Å—á—ë—Ç–∞ (–≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
‚îú‚îÄ‚îÄ calculator/
‚îÇ   ‚îî‚îÄ‚îÄ pds.js            # –†–∞—Å—á—ë—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
‚îú‚îÄ‚îÄ keyboards.js          # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è Telegram
‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îî‚îÄ‚îÄ menu.js           # –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ session/
‚îÇ   ‚îî‚îÄ‚îÄ memoryStore.js    # –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
‚îî‚îÄ‚îÄ pdsCalculator.js      # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–æ—Ç–æ–º
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞:

- `/start` ‚Äî –∑–∞–ø—É—Å–∫ –ü–î–°-–∫–∞–ª—å–∫—É–ª—è—Ç–æ—Ä–∞
- `/menu` ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –≤ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é

### –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å—á—ë—Ç–∞:

1. **–í—ã–±–æ—Ä —Å—Ü–µ–Ω–∞—Ä–∏—è** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –æ–¥–∏–Ω –∏–∑ —Ç—Ä—ë—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
2. **–°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö** ‚Äî –ø–æ—à–∞–≥–æ–≤—ã–π –≤–≤–æ–¥:
   - –ü–æ–ª (–º—É–∂—á–∏–Ω–∞/–∂–µ–Ω—â–∏–Ω–∞)
   - –í–æ–∑—Ä–∞—Å—Ç (18-100 –ª–µ—Ç)
   - –î–æ—Ö–æ–¥ –¥–æ –ù–î–§–õ (0-10,000,000 —Ä—É–±/–º–µ—Å)
   - –†–µ–∂–∏–º –≤–∑–Ω–æ—Å–æ–≤ (–µ–∂–µ–º–µ—Å—è—á–Ω–æ/–µ–∂–µ–≥–æ–¥–Ω–æ)
   - –†–∞–∑–º–µ—Ä –≤–∑–Ω–æ—Å–∞
   - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (—Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª, –û–ü–°)
3. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ** ‚Äî –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **–†–∞—Å—á—ë—Ç** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç** ‚Äî –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ—Ç—á—ë—Ç–∞

## üìä –ú–∞—Ç–µ–º–∞—Ç–∏–∫–∞

### –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã:

- **–ì–æ–¥–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞**: 10% (ANNUAL_RATE = 0.1)
- **–ú–µ—Å—è—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞**: (1 + 0.1)^(1/12) - 1 ‚âà 0.797%

### –§–æ—Ä–º—É–ª—ã:

**–ò—Ç–æ–≥–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª:**

```
K_T = K0 * (1+i)^M + OPS * (1+i)^M + m * [((1+i)^M - 1)/i]
```

–ì–¥–µ:

- `K0` ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤—ã–π –∫–∞–ø–∏—Ç–∞–ª
- `OPS` ‚Äî –ø–µ—Ä–µ–≤–æ–¥ –ø–µ–Ω—Å–∏–æ–Ω–Ω—ã—Ö —Å–±–µ—Ä–µ–∂–µ–Ω–∏–π
- `m` ‚Äî –µ–∂–µ–º–µ—Å—è—á–Ω—ã–π –≤–∑–Ω–æ—Å
- `i` ‚Äî –º–µ—Å—è—á–Ω–∞—è —Å—Ç–∞–≤–∫–∞
- `M` ‚Äî –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–µ—Å—è—Ü–µ–≤

**–í–∞—Ä–∏–∞–Ω—Ç—ã –≤—ã–ø–ª–∞—Ç:**

- –ü–æ–∂–∏–∑–Ω–µ–Ω–Ω–æ (—á–µ—Ä–Ω–æ–≤–∞—è): `K_T / 240`
- –ù–∞ 10 –ª–µ—Ç: `K_T / 120`
- –ï–¥–∏–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ: `K_T`

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
TELEGRAM_BOT_TOKEN=your_bot_token
NODE_ENV=development
```

### –ó–∞–ø—É—Å–∫:

```bash
npm start
```

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:

```bash
npm run start:dev
```

## üìù –°—Ç–∞—Ç—É—Å —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:

- [x] FSM-–¥–∏—Å–ø–µ—Ç—á–µ—Ä —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
- [x] –¢—Ä–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è —Ä–∞—Å—á—ë—Ç–∞ (–±–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞)
- [x] –†–∞—Å—á—ë—Ç–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å 10% –≥–æ–¥–æ–≤—ã—Ö
- [x] –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã –¥–ª—è Telegram
- [x] –•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–µ—Å—Å–∏–π
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º –±–æ—Ç–æ–º
- [x] –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–º–∞–Ω–¥ /start –∏ /menu

### üöß –í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:

- [ ] –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –ì–æ—Å–ø–æ–¥–¥–µ—Ä–∂–∫–∞ (—Å–µ–π—á–∞—Å 0)
- [ ] –ù–∞–ª–æ–≥–æ–≤—ã–π –≤—ã—á–µ—Ç (—Å–µ–π—á–∞—Å 0)
- [ ] –ê–∫—Ç—É–∞—Ä–Ω—ã–µ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –¥–ª—è –ø–æ–∂–∏–∑–Ω–µ–Ω–Ω—ã—Ö –≤—ã–ø–ª–∞—Ç
- [ ] PDF-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤
- [ ] –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

### üìã TODO:

- [ ] –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (Jest)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤—Å–µ —à–∞–≥–∏ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
- [ ] –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫
- [ ] –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

## üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é:

```
üí∞ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞
üè¶ –ö–∞–ø–∏—Ç–∞–ª –∫ –Ω–∞—á–∞–ª—É –≤—ã–ø–ª–∞—Ç
üí∏ –ë–µ–∑ —Ü–µ–ª–∏ ‚Äî —Ä–∞—Å—á—ë—Ç –æ—Ç –≤–∑–Ω–æ—Å–∞
```

### –ü—Ä–∏–º–µ—Ä –¥–∏–∞–ª–æ–≥–∞:

```
üë§ –í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è:
[üë® –ú—É–∂—á–∏–Ω–∞] [üë© –ñ–µ–Ω—â–∏–Ω–∞]

üéÇ –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–∑—Ä–∞—Å—Ç (–ø–æ–ª–Ω—ã—Ö –ª–µ—Ç):

üíµ –í–≤–µ–¥–∏—Ç–µ —Å—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω—ã–π –¥–æ—Ö–æ–¥ –¥–æ –ù–î–§–õ (—Ä—É–±/–º–µ—Å):

üìÖ –í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –≤–∑–Ω–æ—Å–æ–≤:
[üìÖ –ï–∂–µ–º–µ—Å—è—á–Ω–æ] [üìÜ –ï–∂–µ–≥–æ–¥–Ω–æ]

üí∞ –í–≤–µ–¥–∏—Ç–µ —Ä–∞–∑–º–µ—Ä –µ–∂–µ–º–µ—Å—è—á–Ω–æ–≥–æ –≤–∑–Ω–æ—Å–∞ (—Ä—É–±):

‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ–±—Ä–∞–Ω—ã. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞:
[‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –¥–∞–Ω–Ω—ã–µ] [‚úèÔ∏è –ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ]
```

## üîç –û—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏ —Å–µ—Å—Å–∏–π:

```javascript
import { sessionStore } from './src/bot/session/memoryStore.js';
console.log(sessionStore.getStats());
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞—Å—á—ë—Ç–æ–≤:

```javascript
import { calculatePDS } from './src/bot/calculator/pds.js';

const data = {
  gender: 'male',
  age: 30,
  income: 100000,
  monthlyContribution: 10000,
  horizonYears: 20,
};

const result = calculatePDS(data);
console.log(result);
```

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å –≤–≤–µ–¥—ë–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É

---

**–í–µ—Ä—Å–∏—è**: 1.0.0  
**–î–∞—Ç–∞**: 2024  
**–ê–≤—Ç–æ—Ä**: PDS Consultant Team
